<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Boon Coach Library</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=DM+Serif+Text:ital@0;1&family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background: #F0F3F7;
      color: #2E353D;
      min-height: 100vh;
    }

    /* NAV */
    nav {
      background: #fff;
      border-bottom: 1px solid #e2e8f0;
      padding: 0 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 64px;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .nav-logo {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: 22px;
      color: #466FF6;
      letter-spacing: -0.5px;
    }
    .nav-logo span {
      font-family: 'DM Serif Text', serif;
      font-style: italic;
      color: #2E353D;
      font-size: 14px;
      font-weight: 400;
      margin-left: 8px;
    }
    .nav-search {
      display: flex;
      align-items: center;
      background: #F0F3F7;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 8px 14px;
      gap: 8px;
      width: 320px;
    }
    .nav-search input {
      border: none;
      background: transparent;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      color: #2E353D;
      outline: none;
      width: 100%;
    }
    .nav-search input::placeholder { color: #9ca3af; }

    /* HERO */
    .hero {
      background: linear-gradient(135deg, #1A253B 0%, #365ABD 100%);
      padding: 60px 40px;
      text-align: center;
    }
    .hero-label {
      font-family: 'Inter', sans-serif;
      font-weight: 800;
      font-size: 11px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #CCD9FF;
      margin-bottom: 16px;
    }
    .hero h1 {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: 42px;
      color: #fff;
      line-height: 1.15;
      margin-bottom: 12px;
    }
    .hero h1 em {
      font-family: 'DM Serif Text', serif;
      font-style: italic;
      color: #CCD9FF;
      font-weight: 400;
    }
    .hero p {
      color: #CCD9FF;
      font-size: 16px;
      max-width: 520px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* MAIN LAYOUT */
    .main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 48px 24px;
    }

    /* SECTION HEADER */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }
    .section-title {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: 22px;
      color: #2E353D;
    }
    .section-count {
      font-size: 13px;
      color: #6b7280;
      font-weight: 500;
    }

    /* CATEGORY TABS */
    .category-tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 32px;
    }
    .tab {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.15s;
      background: #fff;
      color: #6b7280;
      border-color: #e2e8f0;
    }
    .tab:hover { border-color: #466FF6; color: #466FF6; }
    .tab.active { background: #466FF6; color: #fff; border-color: #466FF6; }

    /* ARTICLE GRID */
    .article-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    /* ARTICLE CARD */
    .article-card {
      background: #fff;
      border-radius: 12px;
      padding: 24px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.15s;
      text-decoration: none;
      color: inherit;
      display: block;
    }
    .article-card:hover {
      border-color: #466FF6;
      box-shadow: 0 4px 20px rgba(70, 111, 246, 0.1);
      transform: translateY(-2px);
    }
    .card-category {
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #466FF6;
      margin-bottom: 10px;
    }
    .card-title {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: 17px;
      color: #2E353D;
      margin-bottom: 10px;
      line-height: 1.3;
    }
    .card-excerpt {
      font-size: 13px;
      color: #6b7280;
      line-height: 1.6;
    }
    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 16px;
    }
    .tag {
      background: #F0F3F7;
      color: #6b7280;
      font-size: 11px;
      font-weight: 600;
      padding: 3px 8px;
      border-radius: 4px;
    }

    /* ARTICLE VIEW */
    .article-view {
      display: none;
      max-width: 740px;
      margin: 0 auto;
    }
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: #466FF6;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      margin-bottom: 32px;
      background: none;
      border: none;
      padding: 0;
    }
    .back-btn:hover { text-decoration: underline; }
    .article-header { margin-bottom: 32px; }
    .article-category-label {
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      color: #466FF6;
      margin-bottom: 12px;
    }
    .article-title {
      font-family: 'DM Sans', sans-serif;
      font-weight: 700;
      font-size: 32px;
      color: #2E353D;
      line-height: 1.2;
      margin-bottom: 16px;
    }
    .article-excerpt {
      font-size: 16px;
      color: #6b7280;
      line-height: 1.6;
      border-left: 3px solid #466FF6;
      padding-left: 16px;
    }
    .article-body {
      background: #fff;
      border-radius: 12px;
      padding: 40px;
      font-size: 15px;
      line-height: 1.8;
      color: #2E353D;
      white-space: pre-wrap;
    }

    /* EMPTY / LOADING */
    .loading {
      text-align: center;
      padding: 80px 20px;
      color: #9ca3af;
      font-size: 15px;
    }
    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid #e2e8f0;
      border-top-color: #466FF6;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* SEARCH RESULTS */
    .search-results-label {
      font-size: 14px;
      color: #6b7280;
      margin-bottom: 20px;
    }
    .search-results-label strong { color: #2E353D; }

    @media (max-width: 600px) {
      nav { padding: 0 20px; }
      .hero { padding: 40px 20px; }
      .hero h1 { font-size: 28px; }
      .main { padding: 32px 16px; }
      .nav-search { display: none; }
    }
  </style>
</head>
<body>

  <nav>
    <div class="nav-logo">BOON <span>Coach Library</span></div>
    <div class="nav-search">
      <svg width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="#9ca3af" stroke-width="2">
        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
      </svg>
      <input type="text" id="searchInput" placeholder="Search frameworks, protocols, templates..." />
    </div>
  </nav>

  <div class="hero">
    <div class="hero-label">For Boon Coaches</div>
    <h1>Everything you need to <em>coach well.</em></h1>
    <p>Frameworks, protocols, session guides, and templates — organized so you can find what you need, when you need it.</p>
  </div>

  <div class="main">

    <!-- LIST VIEW -->
    <div id="listView">
      <div class="category-tabs" id="categoryTabs">
        <div class="tab active" data-slug="all" onclick="filterCategory('all', this)">All</div>
      </div>
      <div class="section-header">
        <div class="section-title" id="sectionTitle">All Articles</div>
        <div class="section-count" id="sectionCount"></div>
      </div>
      <div id="searchResultsLabel" class="search-results-label" style="display:none;"></div>
      <div class="article-grid" id="articleGrid">
        <div class="loading">
          <div class="loading-spinner"></div>
          Loading the library...
        </div>
      </div>
    </div>

    <!-- ARTICLE VIEW -->
    <div id="articleView" class="article-view">
      <button class="back-btn" onclick="showList()">
        ← Back to Library
      </button>
      <div class="article-header">
        <div class="article-category-label" id="articleCategoryLabel"></div>
        <h1 class="article-title" id="articleTitle"></h1>
        <p class="article-excerpt" id="articleExcerpt"></p>
      </div>
      <div class="article-body" id="articleBody"></div>
    </div>

  </div>

  <script>
    const SUPABASE_URL = 'https://psgoldsuyeigwqryenlv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBzZ29sZHN1eWVpZ3dxcnllbmx2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5OTQ3MjMsImV4cCI6MjA4NjU3MDcyM30.YBLAxd46LxIi-EBaoY3qihpPpzv24YtTvx44-iEpO84';

    let allArticles = [];
    let allCategories = [];
    let activeCategory = 'all';

    async function fetchData() {
      try {
        const [articlesRes, categoriesRes] = await Promise.all([
          fetch(`${SUPABASE_URL}/rest/v1/articles?select=*&order=order_index`, {
            headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
          }),
          fetch(`${SUPABASE_URL}/rest/v1/categories?select=*&order=order_index`, {
            headers: { 'apikey': SUPABASE_KEY, 'Authorization': `Bearer ${SUPABASE_KEY}` }
          })
        ]);

        allArticles = await articlesRes.json();
        allCategories = await categoriesRes.json();

        buildCategoryTabs();
        renderArticles(allArticles);
      } catch (err) {
        document.getElementById('articleGrid').innerHTML = `<div class="loading">Unable to load content. Please try again later.</div>`;
      }
    }

    function buildCategoryTabs() {
      const tabs = document.getElementById('categoryTabs');
      allCategories.forEach(cat => {
        const tab = document.createElement('div');
        tab.className = 'tab';
        tab.dataset.slug = cat.slug;
        tab.textContent = `${cat.icon} ${cat.name}`;
        tab.onclick = () => filterCategory(cat.slug, tab);
        tabs.appendChild(tab);
      });
    }

    function filterCategory(slug, el) {
      activeCategory = slug;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      el.classList.add('active');

      const filtered = slug === 'all' ? allArticles : allArticles.filter(a => a.category_slug === slug);
      const cat = allCategories.find(c => c.slug === slug);
      document.getElementById('sectionTitle').textContent = slug === 'all' ? 'All Articles' : cat?.name || '';
      document.getElementById('searchInput').value = '';
      document.getElementById('searchResultsLabel').style.display = 'none';
      renderArticles(filtered);
    }

    function renderArticles(articles) {
      const grid = document.getElementById('articleGrid');
      document.getElementById('sectionCount').textContent = `${articles.length} article${articles.length !== 1 ? 's' : ''}`;

      if (articles.length === 0) {
        grid.innerHTML = `<div class="loading">No articles found.</div>`;
        return;
      }

      grid.innerHTML = articles.map(a => {
        const cat = allCategories.find(c => c.slug === a.category_slug);
        const tags = (a.tags || []).slice(0, 3).map(t => `<span class="tag">${t}</span>`).join('');
        return `
          <div class="article-card" onclick="showArticle('${a.id}')">
            <div class="card-category">${cat?.icon || ''} ${cat?.name || a.category_slug}</div>
            <div class="card-title">${a.title}</div>
            <div class="card-excerpt">${a.excerpt || ''}</div>
            ${tags ? `<div class="card-tags">${tags}</div>` : ''}
          </div>`;
      }).join('');
    }

    function showArticle(id) {
      const article = allArticles.find(a => a.id === id);
      if (!article) return;
      const cat = allCategories.find(c => c.slug === article.category_slug);

      document.getElementById('articleCategoryLabel').textContent = `${cat?.icon || ''} ${cat?.name || ''}`;
      document.getElementById('articleTitle').textContent = article.title;
      document.getElementById('articleExcerpt').textContent = article.excerpt || '';
      document.getElementById('articleBody').textContent = article.content;

      document.getElementById('listView').style.display = 'none';
      document.getElementById('articleView').style.display = 'block';
      window.scrollTo(0, 0);
    }

    function showList() {
      document.getElementById('listView').style.display = 'block';
      document.getElementById('articleView').style.display = 'none';
      window.scrollTo(0, 0);
    }

    // Search
    document.getElementById('searchInput').addEventListener('input', (e) => {
      const q = e.target.value.toLowerCase().trim();
      const label = document.getElementById('searchResultsLabel');

      if (!q) {
        label.style.display = 'none';
        filterCategory(activeCategory, document.querySelector(`.tab[data-slug="${activeCategory}"]`));
        return;
      }

      const results = allArticles.filter(a =>
        a.title.toLowerCase().includes(q) ||
        (a.excerpt || '').toLowerCase().includes(q) ||
        (a.content || '').toLowerCase().includes(q) ||
        (a.tags || []).some(t => t.toLowerCase().includes(q))
      );

      label.style.display = 'block';
      label.innerHTML = `Showing <strong>${results.length}</strong> result${results.length !== 1 ? 's' : ''} for "<strong>${e.target.value}</strong>"`;
      document.getElementById('sectionTitle').textContent = 'Search Results';
      document.getElementById('sectionCount').textContent = '';
      renderArticles(results);
    });

    fetchData();
  </script>
</body>
</html>
